# 水印生成命令行程序详细设计

## 1. 总体架构
- 采用 Python 脚本，命令行交互。
- 主要依赖 pillow（PIL）和 piexif。
- 使用 argparse 解析命令行参数。
- 支持单张图片和目录批量处理。

## 2. 命令行参数设计

| 参数   | 必选  | 类型   | 说明                         | 默认值      | 取值范围/格式           |
|--------|------|--------|------------------------------|-------------|-------------------------|
| -i     | 是   | str    | 输入图片路径或目录           | 无          | 有效路径                |
| -s     | 否   | int    | 水印字体大小                | 24          | 小于等于48的正整数                  |
| -c     | 否   | str    | 水印字体颜色（RGB/HEX/英文） | black       | 如 #FF0000、red         |
| -p     | 否   | str    | 水印位置                     | rb         | lt（左上）/c（居中）/rb（右下）/lb（左下）/rt（左上） |
| -h / --help | 否   |        | 查看帮助                     |             |                         |

## 3. 功能实现细节

### 3.1 输入路径处理
- 判断输入路径是文件还是目录。
- 若为目录，递归遍历所有图片文件（支持 JPG、PNG）。
- 若为文件，直接处理。

### 3.2 EXIF 信息读取
- 使用 piexif 读取图片 EXIF。
- 提取 DateTimeOriginal 字段，格式如 "YYYY:MM:DD HH:MM:SS"。
- 仅取年月日部分，格式化为 "YYYY-MM-DD"。
- 若无 EXIF 或无拍摄时间：
  - 跳过该图片并记录日志，或在水印中显示“无拍摄时间”。

### 3.3 水印文本生成
- 默认水印内容为拍摄日期（YYYY-MM-DD）。

### 3.4 水印绘制
- 使用 pillow 的 ImageDraw 和 ImageFont。
- 字体大小、颜色、位置由参数控制。
- 位置支持：
  - lt（左上）
  - rt（右上）
  - lb（左下）
  - rb（右下）
  - c（居中）
- 颜色支持英文名、十六进制（#RRGGBB）、RGB 三元组。
- 字体使用用 pillow 默认字体。

### 3.5 输出目录与文件
- 输出目录为“原目录名_watermark”，与原目录同级。
- 若输入为单文件，则输出到同目录下的“watermark”子目录。
- 输出文件名与原文件一致。
- 若输出目录不存在则自动创建。

### 3.6 容错处理
- 输入路径不存在：提示错误并退出。
- 非图片文件：自动跳过。
- 图片无 EXIF 或无拍摄时间：
  - 水印显示“无拍摄时间”。
- 字体文件路径无效：提示警告，使用默认字体。
- 参数非法（如负数、无效颜色）：提示错误并退出。
- 输出目录创建失败：提示错误并退出。

### 3.7 日志与提示
- 处理结果、跳过文件、错误信息均在命令行输出。
- 可扩展为写入日志文件。

## 4. 依赖库
- pillow
- piexif
- argparse（标准库）
- os、sys、pathlib、shutil（标准库）

## 5. 示例命令
```
python watermark.py -i "./photos" -s 32 -c "#FF0000" -p rb
python watermark.py -i "./a.jpg" -s 20 -c "blue" -p c
```

## 6. 目录结构建议
- watermark.py
- sheji.md
- xuqiu.md
